[
    {
        "id": "2de9a494ac1d6c71",
        "type": "tab",
        "label": "HVAC",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "7d41aab9fd0b6a3e",
        "type": "tab",
        "label": "ESP32",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "13aa577370e4c4d7",
        "type": "tab",
        "label": "Logs/Notifications",
        "disabled": false,
        "info": ""
    },
    {
        "id": "536b0e9eda614fd2",
        "type": "tab",
        "label": "Zigbee",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "05e865126427c1f9",
        "type": "tab",
        "label": "Motion",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "67e1c6f6bd2fab57",
        "type": "tab",
        "label": "Sunrise/Sunset",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "86c7bfe22f048e9c",
        "type": "tab",
        "label": "Tasmota",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "4289ddd18011b400",
        "type": "tab",
        "label": "Dogo",
        "disabled": true,
        "info": ""
    },
    {
        "id": "fd418eb5a2d37315",
        "type": "junction",
        "z": "7d41aab9fd0b6a3e",
        "x": 300,
        "y": 320,
        "wires": [
            [
                "f648133e35429919",
                "8521a26270a7f5ed",
                "d2f287de8e2b7bdb",
                "b7b0b4d5c552d29a",
                "0450c2ce91a72b78",
                "dfc52bfc266069f0",
                "6762d86fa674744b",
                "b2a67d17df0195f8",
                "31ccd8e9f0a2e09e",
                "917568c1def8a578"
            ]
        ]
    },
    {
        "id": "80206ddcbd9d94f1",
        "type": "junction",
        "z": "7d41aab9fd0b6a3e",
        "x": 680,
        "y": 320,
        "wires": [
            [
                "6af1216eb7c5c03f"
            ]
        ]
    },
    {
        "id": "841b001db8f4d3d5",
        "type": "junction",
        "z": "7d41aab9fd0b6a3e",
        "x": 980,
        "y": 620,
        "wires": [
            [
                "645b5b8f07f055fc",
                "dc8db494b158e485",
                "7426cbb773e5162c",
                "efac8720a10238d0",
                "6b14f65c73a0bf69",
                "ba592d172f57dd43",
                "a3dbdc255ebe8243"
            ]
        ]
    },
    {
        "id": "af0b3ee1164dc74c",
        "type": "junction",
        "z": "7d41aab9fd0b6a3e",
        "x": 980,
        "y": 260,
        "wires": [
            [
                "1eeea8ddfe40852e",
                "144549cc6dc7cbe7",
                "8714fba0422dd9f9",
                "c78d7adf71b71c07",
                "6ebdf6901c3c44a1",
                "177b7b13cf11baf0"
            ]
        ]
    },
    {
        "id": "3d478a662ee44292",
        "type": "junction",
        "z": "13aa577370e4c4d7",
        "x": 180,
        "y": 380,
        "wires": [
            [
                "b7e650722bc17863",
                "5b83184da40ca65f",
                "357104d13b31bb08"
            ]
        ]
    },
    {
        "id": "f1e538c1.0315f8",
        "type": "noraf-config",
        "name": "NORA",
        "group": "seceani",
        "twofactor": "off",
        "twofactorpin": "",
        "localexecution": true,
        "structure": "Seceani",
        "storeStateInContext": true,
        "disableValidationErrors": false,
        "sendDeviceNameAndLocation": false
    },
    {
        "id": "f569d34c.8c7ed",
        "type": "mqtt-broker",
        "name": "",
        "broker": "localhost",
        "port": "1883",
        "clientid": "node-red",
        "autoConnect": true,
        "usetls": false,
        "protocolVersion": "4",
        "keepalive": "60",
        "cleansession": true,
        "birthTopic": "",
        "birthQos": "0",
        "birthPayload": "",
        "birthMsg": {},
        "closeTopic": "",
        "closeQos": "0",
        "closePayload": "",
        "closeMsg": {},
        "willTopic": "",
        "willQos": "0",
        "willPayload": "",
        "willMsg": {},
        "sessionExpiry": ""
    },
    {
        "id": "3302889fa9b7cb44",
        "type": "noraf-config",
        "name": "NORA - test",
        "group": "test",
        "twofactor": "off",
        "twofactorpin": "",
        "localexecution": true,
        "structure": "",
        "storeStateInContext": true,
        "disableValidationErrors": false,
        "sendDeviceNameAndLocation": false
    },
    {
        "id": "89e46ce21c7f5128",
        "type": "nibe-config",
        "name": "nibe config",
        "address": "tcp://192.168.68.24:0502",
        "registerFile": ""
    },
    {
        "id": "651eb38aa48c6e2a",
        "type": "nibe-register",
        "z": "2de9a494ac1d6c71",
        "name": "",
        "register": "Humidity (AZ30-BM20)",
        "nibe": "89e46ce21c7f5128",
        "interval": "300",
        "timeout": "5",
        "force": false,
        "topic": "",
        "filter": false,
        "x": 160,
        "y": 60,
        "wires": [
            [
                "1895125bc221a5c6"
            ]
        ]
    },
    {
        "id": "ed13633a52b01660",
        "type": "nibe-register",
        "z": "2de9a494ac1d6c71",
        "name": "",
        "register": "Increased ventilation 1",
        "nibe": "89e46ce21c7f5128",
        "interval": "5",
        "timeout": "5",
        "force": true,
        "topic": "ventilation-boost",
        "filter": true,
        "x": 240,
        "y": 220,
        "wires": [
            [
                "1cd1125ce32c5aca"
            ]
        ]
    },
    {
        "id": "27d499b6a6e0d7e5",
        "type": "nibe-register",
        "z": "2de9a494ac1d6c71",
        "name": "",
        "register": "Bypass during heating (ERS 1)",
        "nibe": "89e46ce21c7f5128",
        "interval": "300",
        "timeout": "5",
        "force": false,
        "topic": "",
        "filter": false,
        "x": 570,
        "y": 60,
        "wires": [
            [
                "639e21cb7adb71ba"
            ]
        ]
    },
    {
        "id": "719187bb860811ae",
        "type": "nibe-register",
        "z": "2de9a494ac1d6c71",
        "name": "Fan speed (AZ30-GQ3)",
        "register": "40136",
        "nibe": "89e46ce21c7f5128",
        "interval": "30",
        "timeout": "5",
        "force": false,
        "topic": "",
        "filter": false,
        "x": 1010,
        "y": 280,
        "wires": [
            []
        ]
    },
    {
        "id": "975b4952ce9a0378",
        "type": "nibe-register",
        "z": "2de9a494ac1d6c71",
        "name": "Fan speed (AZ30-GQ2)",
        "register": "40135",
        "nibe": "89e46ce21c7f5128",
        "interval": "30",
        "timeout": "5",
        "force": false,
        "topic": "",
        "filter": false,
        "x": 1010,
        "y": 220,
        "wires": [
            []
        ]
    },
    {
        "id": "4b7ea65a94ecfaf3",
        "type": "nibe-register",
        "z": "2de9a494ac1d6c71",
        "name": "Living setpoint (heat)",
        "register": "id:12802",
        "nibe": "89e46ce21c7f5128",
        "interval": "5",
        "timeout": "5",
        "force": false,
        "topic": "living/setpointLow",
        "filter": true,
        "x": 240,
        "y": 520,
        "wires": [
            [
                "25ecd6270bd33719"
            ]
        ]
    },
    {
        "id": "8a2d91b19d4ef994",
        "type": "nibe-register",
        "z": "2de9a494ac1d6c71",
        "name": "Bedroom setpoint (heat)",
        "register": "id:12803",
        "nibe": "89e46ce21c7f5128",
        "interval": "5",
        "timeout": "5",
        "force": false,
        "topic": "bedroom/setpointLow",
        "filter": true,
        "x": 250,
        "y": 640,
        "wires": [
            [
                "25ecd6270bd33719"
            ]
        ]
    },
    {
        "id": "aa438942649ecf58",
        "type": "nibe-register",
        "z": "2de9a494ac1d6c71",
        "name": "Living temp.",
        "register": "Roomsensor 2-1",
        "nibe": "89e46ce21c7f5128",
        "interval": "300",
        "timeout": "5",
        "force": false,
        "topic": "living/temperature",
        "filter": false,
        "x": 210,
        "y": 400,
        "wires": [
            [
                "25ecd6270bd33719"
            ]
        ]
    },
    {
        "id": "59d2b8582a86cef6",
        "type": "nibe-register",
        "z": "2de9a494ac1d6c71",
        "name": "",
        "register": "Priority",
        "nibe": "89e46ce21c7f5128",
        "interval": "60",
        "timeout": "5",
        "force": false,
        "topic": "",
        "filter": false,
        "x": 960,
        "y": 400,
        "wires": [
            [
                "649a67b05469e039"
            ]
        ]
    },
    {
        "id": "649a67b05469e039",
        "type": "function",
        "z": "2de9a494ac1d6c71",
        "name": "Priority",
        "func": "const map = {\n    '10': 'off',\n    '20': 'hotwater',\n    '30': 'heat',\n    '40': 'pool',\n    '60': 'cooling',\n};\n\nnode.status({ fill: \"blue\", shape: \"dot\", text: map[msg.payload.value] });\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1120,
        "y": 400,
        "wires": [
            []
        ]
    },
    {
        "id": "ab2ab1c68494a0de",
        "type": "nibe-register",
        "z": "2de9a494ac1d6c71",
        "name": "",
        "register": "Current hot water mode",
        "nibe": "89e46ce21c7f5128",
        "interval": "10",
        "timeout": "5",
        "force": false,
        "topic": "",
        "filter": false,
        "x": 1010,
        "y": 340,
        "wires": [
            []
        ]
    },
    {
        "id": "99b78cb07dd4c043",
        "type": "nibe-register",
        "z": "2de9a494ac1d6c71",
        "name": "More hot water",
        "register": "30697",
        "nibe": "89e46ce21c7f5128",
        "interval": "5",
        "timeout": "5",
        "force": true,
        "topic": "more-hot-water",
        "filter": true,
        "x": 220,
        "y": 280,
        "wires": [
            [
                "1cd1125ce32c5aca"
            ]
        ]
    },
    {
        "id": "1895125bc221a5c6",
        "type": "function",
        "z": "2de9a494ac1d6c71",
        "name": "decide",
        "func": "const stopRecovery = flow.get('bypass_recovery') === 1;\nconst humidity = msg.payload.value;\nconst target = 45;\nconst histerezis = 2;\nconst compareTo = target + (stopRecovery ? -1 : 1) * histerezis;\nconst shouldStopRecovery = humidity >= compareTo;\n\nnode.status({\n    fill: shouldStopRecovery ? 'red' : \"blue\",\n    shape: \"dot\",\n    text: `recovery ${shouldStopRecovery ? 'off' : 'on'}`,\n});\n\nreturn {\n    payload: shouldStopRecovery ? 1 : 0,\n};\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 330,
        "y": 60,
        "wires": [
            []
        ]
    },
    {
        "id": "639e21cb7adb71ba",
        "type": "change",
        "z": "2de9a494ac1d6c71",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "bypass_recovery",
                "pt": "flow",
                "to": "payload.value",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 870,
        "y": 60,
        "wires": [
            []
        ]
    },
    {
        "id": "b4f19b227252fe50",
        "type": "inject",
        "z": "2de9a494ac1d6c71",
        "name": "on",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "1",
        "payloadType": "num",
        "x": 326.1999816894531,
        "y": 128.1999969482422,
        "wires": [
            [
                "27d499b6a6e0d7e5"
            ]
        ]
    },
    {
        "id": "696ea15c4918cf37",
        "type": "inject",
        "z": "2de9a494ac1d6c71",
        "name": "off",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "0",
        "payloadType": "num",
        "x": 326.1999816894531,
        "y": 168.1999969482422,
        "wires": [
            [
                "27d499b6a6e0d7e5"
            ]
        ]
    },
    {
        "id": "46b0b3fc4d086f1e",
        "type": "noraf-switch",
        "z": "2de9a494ac1d6c71",
        "devicename": "Ventilation Boost",
        "roomhint": "Service Room",
        "name": "",
        "passthru": false,
        "errorifstateunchaged": false,
        "nora": "f1e538c1.0315f8",
        "topic": "ventilation-boost",
        "onvalue": "1",
        "onvalueType": "num",
        "offvalue": "0",
        "offvalueType": "num",
        "twofactor": "ack",
        "twofactorpin": "",
        "filter": true,
        "asyncCmd": false,
        "outputs": 1,
        "x": 610,
        "y": 220,
        "wires": [
            [
                "660188df0186d9af"
            ]
        ]
    },
    {
        "id": "1cd1125ce32c5aca",
        "type": "function",
        "z": "2de9a494ac1d6c71",
        "name": "map",
        "func": "return {\n    payload: msg.payload.value,\n    topic: msg.topic,\n};",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 430,
        "y": 260,
        "wires": [
            [
                "46b0b3fc4d086f1e",
                "f07580f20f9c8e5f"
            ]
        ]
    },
    {
        "id": "f07580f20f9c8e5f",
        "type": "noraf-switch",
        "z": "2de9a494ac1d6c71",
        "devicename": "More hot water",
        "roomhint": "Service Room",
        "name": "",
        "passthru": false,
        "errorifstateunchaged": false,
        "nora": "f1e538c1.0315f8",
        "topic": "more-hot-water",
        "onvalue": "1",
        "onvalueType": "num",
        "offvalue": "0",
        "offvalueType": "num",
        "twofactor": "ack",
        "twofactorpin": "",
        "filter": true,
        "asyncCmd": false,
        "outputs": 1,
        "x": 600,
        "y": 280,
        "wires": [
            [
                "660188df0186d9af"
            ]
        ]
    },
    {
        "id": "9f8ecdb12e5082f5",
        "type": "link in",
        "z": "2de9a494ac1d6c71",
        "name": "link in 8",
        "links": [
            "660188df0186d9af"
        ],
        "x": 75,
        "y": 260,
        "wires": [
            [
                "ed13633a52b01660",
                "99b78cb07dd4c043"
            ]
        ]
    },
    {
        "id": "660188df0186d9af",
        "type": "link out",
        "z": "2de9a494ac1d6c71",
        "name": "link out 6",
        "mode": "link",
        "links": [
            "9f8ecdb12e5082f5"
        ],
        "x": 765,
        "y": 260,
        "wires": []
    },
    {
        "id": "df27d4e5b15bc14e",
        "type": "trigger",
        "z": "2de9a494ac1d6c71",
        "name": "",
        "op1": "{\"value\":true}",
        "op2": "{\"value\":false}",
        "op1type": "json",
        "op2type": "json",
        "duration": "1",
        "extend": true,
        "overrideDelay": false,
        "units": "min",
        "reset": "",
        "bytopic": "all",
        "topic": "topic",
        "outputs": 1,
        "x": 310,
        "y": 740,
        "wires": [
            [
                "3760822f76a88122"
            ]
        ]
    },
    {
        "id": "015082b95c8d867b",
        "type": "nibe-register",
        "z": "2de9a494ac1d6c71",
        "name": "Living setpoint (cool)",
        "register": "id:12842",
        "nibe": "89e46ce21c7f5128",
        "interval": "5",
        "timeout": "5",
        "force": false,
        "topic": "living/setpointHigh",
        "filter": true,
        "x": 240,
        "y": 580,
        "wires": [
            [
                "25ecd6270bd33719"
            ]
        ]
    },
    {
        "id": "f259002bf50c8663",
        "type": "nibe-register",
        "z": "2de9a494ac1d6c71",
        "name": "Bedroom setpoint (cool)",
        "register": "id:12843",
        "nibe": "89e46ce21c7f5128",
        "interval": "5",
        "timeout": "5",
        "force": false,
        "topic": "bedroom/setpointHigh",
        "filter": true,
        "x": 250,
        "y": 700,
        "wires": [
            [
                "25ecd6270bd33719",
                "df27d4e5b15bc14e"
            ]
        ]
    },
    {
        "id": "e56377cc659b2c95",
        "type": "noraf-thermostat",
        "z": "2de9a494ac1d6c71",
        "devicename": "Thermostat",
        "roomhint": "Living Room",
        "name": "living",
        "modes": "off,heatcool",
        "unit": "C",
        "rangeMin": "19",
        "rangeMax": "27",
        "topic": "living",
        "passthru": false,
        "commandOnly": false,
        "queryOnly": false,
        "bufferRangeCelsius": "1",
        "nora": "f1e538c1.0315f8",
        "twofactor": "off",
        "twofactorpin": "",
        "filter": true,
        "x": 750,
        "y": 500,
        "wires": [
            [
                "a5df44a963725282"
            ]
        ]
    },
    {
        "id": "da510ff457d3be7d",
        "type": "nibe-register",
        "z": "2de9a494ac1d6c71",
        "name": "",
        "register": "Humidity (AZ30-BM20)",
        "nibe": "89e46ce21c7f5128",
        "interval": "300",
        "timeout": "5",
        "force": false,
        "topic": "humidity",
        "filter": false,
        "x": 240,
        "y": 340,
        "wires": [
            [
                "25ecd6270bd33719"
            ]
        ]
    },
    {
        "id": "25ecd6270bd33719",
        "type": "function",
        "z": "2de9a494ac1d6c71",
        "name": "map",
        "func": "const parts = msg.topic.split('/');\nconst rooms = parts.length === 2\n    ? [parts[0]]\n    : (context.keys() ?? []);\nconst prop = parts[parts.length - 1];\n\nconst msgs = rooms.map(room => {\n    const state = {\n        ...(context.get(room) ?? {}),\n        mode: 'heatcool',\n        activeMode: 'cool',\n    };\n    state[prop] = msg.payload.value;\n    context.set(room, state);\n    return { topic: room, payload: state };\n});\n\nreturn [msgs];\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 590,
        "y": 540,
        "wires": [
            [
                "e56377cc659b2c95",
                "b7cb59e0445cf704"
            ]
        ]
    },
    {
        "id": "b7cb59e0445cf704",
        "type": "noraf-thermostat",
        "z": "2de9a494ac1d6c71",
        "devicename": "Thermostat",
        "roomhint": "Office",
        "name": "bedroom",
        "modes": "off,heatcool",
        "unit": "C",
        "rangeMin": "19",
        "rangeMax": "27",
        "topic": "bedroom",
        "passthru": false,
        "commandOnly": false,
        "queryOnly": false,
        "bufferRangeCelsius": "1",
        "nora": "f1e538c1.0315f8",
        "twofactor": "off",
        "twofactorpin": "",
        "filter": true,
        "x": 760,
        "y": 560,
        "wires": [
            [
                "a5df44a963725282"
            ]
        ]
    },
    {
        "id": "a5df44a963725282",
        "type": "function",
        "z": "2de9a494ac1d6c71",
        "name": "map",
        "func": "const propsToCopy = ['setpointLow', 'setpointHigh'];\nconst messages = propsToCopy.map(key => ({\n    topic: `${msg.topic}/${key}`,\n    payload: msg.payload[key],\n}));\nreturn [messages]",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 950,
        "y": 540,
        "wires": [
            [
                "847b62e1d562ef8b"
            ]
        ]
    },
    {
        "id": "61d8d50274c6ed71",
        "type": "link out",
        "z": "2de9a494ac1d6c71",
        "name": "link out 8",
        "mode": "link",
        "links": [
            "50badacef6b71f47"
        ],
        "x": 1155,
        "y": 540,
        "wires": []
    },
    {
        "id": "50badacef6b71f47",
        "type": "link in",
        "z": "2de9a494ac1d6c71",
        "name": "link in 10",
        "links": [
            "61d8d50274c6ed71"
        ],
        "x": 75,
        "y": 540,
        "wires": [
            [
                "8a2d91b19d4ef994",
                "f259002bf50c8663",
                "4b7ea65a94ecfaf3",
                "015082b95c8d867b"
            ]
        ]
    },
    {
        "id": "e12aab3001f9c07c",
        "type": "nibe-register",
        "z": "2de9a494ac1d6c71",
        "name": "Bedroom temp.",
        "register": "Roomsensor 3-1",
        "nibe": "89e46ce21c7f5128",
        "interval": "300",
        "timeout": "5",
        "force": false,
        "topic": "bedroom/temperature",
        "filter": false,
        "x": 220,
        "y": 460,
        "wires": [
            [
                "25ecd6270bd33719"
            ]
        ]
    },
    {
        "id": "3760822f76a88122",
        "type": "function",
        "z": "2de9a494ac1d6c71",
        "name": "online",
        "func": "return {\n    ...msg,\n    topic: 'online',\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 450,
        "y": 740,
        "wires": [
            [
                "25ecd6270bd33719"
            ]
        ]
    },
    {
        "id": "847b62e1d562ef8b",
        "type": "rbe",
        "z": "2de9a494ac1d6c71",
        "name": "",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "septopics": true,
        "property": "payload",
        "topi": "topic",
        "x": 1070,
        "y": 540,
        "wires": [
            [
                "61d8d50274c6ed71"
            ]
        ]
    },
    {
        "id": "5bb98af947157223",
        "type": "node-espota",
        "z": "7d41aab9fd0b6a3e",
        "firmwareLink": "https://github.com/andrei-tatar/ha-wifi-switch/releases/latest/download/ha_switch_esp32.bin",
        "extractHost": "^ha-switch/(.+)/version$",
        "excludeHost": "switch-dimmer-8",
        "name": "",
        "x": 430,
        "y": 140,
        "wires": []
    },
    {
        "id": "f2dddb9e4756a85a",
        "type": "mqtt in",
        "z": "7d41aab9fd0b6a3e",
        "name": "",
        "topic": "ha-switch/+/version",
        "qos": "0",
        "datatype": "utf8",
        "broker": "f569d34c.8c7ed",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 190,
        "y": 140,
        "wires": [
            [
                "5bb98af947157223"
            ]
        ]
    },
    {
        "id": "b5f045d301d04cf3",
        "type": "inject",
        "z": "7d41aab9fd0b6a3e",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "update",
        "payload": "",
        "payloadType": "date",
        "x": 190,
        "y": 100,
        "wires": [
            [
                "5bb98af947157223"
            ]
        ]
    },
    {
        "id": "f648133e35429919",
        "type": "noraf-light",
        "z": "7d41aab9fd0b6a3e",
        "devicename": "Main",
        "lightcolor": false,
        "brightnesscontrol": true,
        "commandonlycolor": false,
        "turnonwhenbrightnesschanges": true,
        "passthru": false,
        "errorifstateunchaged": false,
        "statepayload": true,
        "brightnessoverride": "",
        "roomhint": "Hallway",
        "name": "3. hallway - main",
        "colortype": "hsv",
        "nora": "f1e538c1.0315f8",
        "topic": "ha-switch/switch-dimmer-3/state",
        "onvalue": "true",
        "onvalueType": "bool",
        "offvalue": "false",
        "offvalueType": "bool",
        "temperaturemin": "2700",
        "temperaturemax": "5500",
        "twofactor": "off",
        "twofactorpin": "",
        "filter": true,
        "x": 470,
        "y": 200,
        "wires": [
            [
                "80206ddcbd9d94f1"
            ]
        ]
    },
    {
        "id": "8521a26270a7f5ed",
        "type": "noraf-light",
        "z": "7d41aab9fd0b6a3e",
        "devicename": "Dining",
        "lightcolor": false,
        "brightnesscontrol": true,
        "commandonlycolor": false,
        "turnonwhenbrightnesschanges": true,
        "passthru": false,
        "errorifstateunchaged": false,
        "statepayload": true,
        "brightnessoverride": "",
        "roomhint": "Living Room",
        "name": "12. living - dining",
        "colortype": "hsv",
        "nora": "f1e538c1.0315f8",
        "topic": "ha-switch/switch-dimmer-12/state",
        "onvalue": "true",
        "onvalueType": "bool",
        "offvalue": "false",
        "offvalueType": "bool",
        "temperaturemin": "2700",
        "temperaturemax": "5500",
        "twofactor": "off",
        "twofactorpin": "",
        "filter": true,
        "x": 470,
        "y": 380,
        "wires": [
            [
                "80206ddcbd9d94f1"
            ]
        ]
    },
    {
        "id": "d2f287de8e2b7bdb",
        "type": "noraf-light",
        "z": "7d41aab9fd0b6a3e",
        "devicename": "Yard",
        "lightcolor": false,
        "brightnesscontrol": true,
        "commandonlycolor": false,
        "turnonwhenbrightnesschanges": true,
        "passthru": false,
        "errorifstateunchaged": false,
        "statepayload": true,
        "brightnessoverride": "",
        "roomhint": "Outside",
        "name": "11. outside - yard",
        "colortype": "hsv",
        "nora": "f1e538c1.0315f8",
        "topic": "ha-switch/switch-dimmer-11/state",
        "onvalue": "true",
        "onvalueType": "bool",
        "offvalue": "false",
        "offvalueType": "bool",
        "temperaturemin": "2700",
        "temperaturemax": "5500",
        "twofactor": "off",
        "twofactorpin": "",
        "filter": true,
        "x": 470,
        "y": 440,
        "wires": [
            [
                "80206ddcbd9d94f1"
            ]
        ]
    },
    {
        "id": "b7b0b4d5c552d29a",
        "type": "noraf-light",
        "z": "7d41aab9fd0b6a3e",
        "devicename": "Light",
        "lightcolor": false,
        "brightnesscontrol": true,
        "commandonlycolor": false,
        "turnonwhenbrightnesschanges": true,
        "passthru": false,
        "errorifstateunchaged": false,
        "statepayload": true,
        "brightnessoverride": "",
        "roomhint": "Bedroom",
        "name": "2. big bedroom",
        "colortype": "hsv",
        "nora": "f1e538c1.0315f8",
        "topic": "ha-switch/switch-dimmer-2/state",
        "onvalue": "true",
        "onvalueType": "bool",
        "offvalue": "false",
        "offvalueType": "bool",
        "temperaturemin": "2700",
        "temperaturemax": "5500",
        "twofactor": "off",
        "twofactorpin": "",
        "filter": true,
        "x": 460,
        "y": 500,
        "wires": [
            [
                "80206ddcbd9d94f1"
            ]
        ]
    },
    {
        "id": "645b5b8f07f055fc",
        "type": "noraf-openclose",
        "z": "7d41aab9fd0b6a3e",
        "devicename": "Shutters",
        "roomhint": "Bedroom",
        "name": "3. big bedroom",
        "directions": "",
        "openclosetype": "SHUTTER",
        "passthru": false,
        "errorifstateunchaged": false,
        "discrete": false,
        "lockunlock": false,
        "commandonly": false,
        "queryonly": false,
        "nora": "f1e538c1.0315f8",
        "topic": "ha-switch/switch-blinds-3/state",
        "openvalue": "true",
        "openvalueType": "bool",
        "closevalue": "false",
        "closevalueType": "bool",
        "twofactor": "off",
        "twofactorpin": "",
        "filter": true,
        "x": 1140,
        "y": 620,
        "wires": [
            [
                "8ad4a13f3069f1ac"
            ]
        ]
    },
    {
        "id": "8ad4a13f3069f1ac",
        "type": "function",
        "z": "7d41aab9fd0b6a3e",
        "name": "map",
        "func": "return {\n    payload: {\n        openPercent: msg.payload.open,\n    },\n    topic: msg.topic,\n};",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1350,
        "y": 620,
        "wires": [
            [
                "49583d9de218bf42"
            ]
        ]
    },
    {
        "id": "b18a911a13f74c55",
        "type": "function",
        "z": "7d41aab9fd0b6a3e",
        "name": "dimmers",
        "func": "if (msg.topic.startsWith('ha-switch/switch-dimmer-'))\n    return msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 200,
        "y": 320,
        "wires": [
            [
                "fd418eb5a2d37315"
            ]
        ]
    },
    {
        "id": "821e92a25e3b217f",
        "type": "function",
        "z": "7d41aab9fd0b6a3e",
        "name": "blinds",
        "func": "if (msg.topic.startsWith('ha-switch/switch-blinds-')) {\n    return {\n        payload: {\n            open: msg.payload.openPercent,\n            online: msg.payload.online,\n        },\n        topic: msg.topic,\n    };\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 890,
        "y": 620,
        "wires": [
            [
                "841b001db8f4d3d5"
            ]
        ]
    },
    {
        "id": "dc8db494b158e485",
        "type": "noraf-openclose",
        "z": "7d41aab9fd0b6a3e",
        "devicename": "Shutters",
        "roomhint": "Office",
        "name": "5. office",
        "directions": "",
        "openclosetype": "SHUTTER",
        "passthru": false,
        "errorifstateunchaged": false,
        "discrete": false,
        "lockunlock": false,
        "commandonly": false,
        "queryonly": false,
        "nora": "f1e538c1.0315f8",
        "topic": "ha-switch/switch-blinds-5/state",
        "openvalue": "true",
        "openvalueType": "bool",
        "closevalue": "false",
        "closevalueType": "bool",
        "twofactor": "off",
        "twofactorpin": "",
        "filter": true,
        "x": 1120,
        "y": 680,
        "wires": [
            [
                "8ad4a13f3069f1ac"
            ]
        ]
    },
    {
        "id": "917568c1def8a578",
        "type": "noraf-light",
        "z": "7d41aab9fd0b6a3e",
        "devicename": "Light",
        "lightcolor": false,
        "brightnesscontrol": true,
        "commandonlycolor": false,
        "turnonwhenbrightnesschanges": true,
        "passthru": false,
        "errorifstateunchaged": false,
        "statepayload": true,
        "brightnessoverride": "",
        "roomhint": "Office",
        "name": "8. office",
        "colortype": "hsv",
        "nora": "f1e538c1.0315f8",
        "topic": "ha-switch/switch-dimmer-8/state",
        "onvalue": "true",
        "onvalueType": "bool",
        "offvalue": "false",
        "offvalueType": "bool",
        "temperaturemin": "2700",
        "temperaturemax": "5500",
        "twofactor": "off",
        "twofactorpin": "",
        "filter": true,
        "x": 440,
        "y": 620,
        "wires": [
            [
                "80206ddcbd9d94f1"
            ]
        ]
    },
    {
        "id": "0450c2ce91a72b78",
        "type": "noraf-light",
        "z": "7d41aab9fd0b6a3e",
        "devicename": "TV Light",
        "lightcolor": false,
        "brightnesscontrol": true,
        "commandonlycolor": false,
        "turnonwhenbrightnesschanges": true,
        "passthru": false,
        "errorifstateunchaged": false,
        "statepayload": true,
        "brightnessoverride": "",
        "roomhint": "Living Room",
        "name": "4. living - main",
        "colortype": "hsv",
        "nora": "f1e538c1.0315f8",
        "topic": "ha-switch/switch-dimmer-4/state",
        "onvalue": "true",
        "onvalueType": "bool",
        "offvalue": "false",
        "offvalueType": "bool",
        "temperaturemin": "2700",
        "temperaturemax": "5500",
        "twofactor": "off",
        "twofactorpin": "",
        "filter": true,
        "x": 460,
        "y": 320,
        "wires": [
            [
                "80206ddcbd9d94f1"
            ]
        ]
    },
    {
        "id": "dfc52bfc266069f0",
        "type": "noraf-light",
        "z": "7d41aab9fd0b6a3e",
        "devicename": "Light",
        "lightcolor": false,
        "brightnesscontrol": true,
        "commandonlycolor": false,
        "turnonwhenbrightnesschanges": true,
        "passthru": false,
        "errorifstateunchaged": false,
        "statepayload": true,
        "brightnessoverride": "",
        "roomhint": "Kitchen",
        "name": "7. kitchen",
        "colortype": "hsv",
        "nora": "f1e538c1.0315f8",
        "topic": "ha-switch/switch-dimmer-7/state",
        "onvalue": "true",
        "onvalueType": "bool",
        "offvalue": "false",
        "offvalueType": "bool",
        "temperaturemin": "2700",
        "temperaturemax": "5500",
        "twofactor": "off",
        "twofactorpin": "",
        "filter": true,
        "x": 440,
        "y": 680,
        "wires": [
            [
                "80206ddcbd9d94f1"
            ]
        ]
    },
    {
        "id": "7426cbb773e5162c",
        "type": "noraf-openclose",
        "z": "7d41aab9fd0b6a3e",
        "devicename": "Door Shutters",
        "roomhint": "Living Room",
        "name": "4. living - door",
        "directions": "",
        "openclosetype": "SHUTTER",
        "passthru": false,
        "errorifstateunchaged": false,
        "discrete": false,
        "lockunlock": false,
        "commandonly": false,
        "queryonly": false,
        "nora": "f1e538c1.0315f8",
        "topic": "ha-switch/switch-blinds-4/state",
        "openvalue": "true",
        "openvalueType": "bool",
        "closevalue": "false",
        "closevalueType": "bool",
        "twofactor": "off",
        "twofactorpin": "",
        "filter": true,
        "x": 1140,
        "y": 740,
        "wires": [
            [
                "8ad4a13f3069f1ac"
            ]
        ]
    },
    {
        "id": "efac8720a10238d0",
        "type": "noraf-openclose",
        "z": "7d41aab9fd0b6a3e",
        "devicename": "Window Shutters",
        "roomhint": "Living Room",
        "name": "6. living - window",
        "directions": "",
        "openclosetype": "SHUTTER",
        "passthru": false,
        "errorifstateunchaged": false,
        "discrete": false,
        "lockunlock": false,
        "commandonly": false,
        "queryonly": false,
        "nora": "f1e538c1.0315f8",
        "topic": "ha-switch/switch-blinds-6/state",
        "openvalue": "true",
        "openvalueType": "bool",
        "closevalue": "false",
        "closevalueType": "bool",
        "twofactor": "off",
        "twofactorpin": "",
        "filter": true,
        "x": 1150,
        "y": 800,
        "wires": [
            [
                "8ad4a13f3069f1ac"
            ]
        ]
    },
    {
        "id": "6b14f65c73a0bf69",
        "type": "noraf-openclose",
        "z": "7d41aab9fd0b6a3e",
        "devicename": "Shutters",
        "roomhint": "Kitchen",
        "name": "2. kitchen window",
        "directions": "",
        "openclosetype": "SHUTTER",
        "passthru": false,
        "errorifstateunchaged": false,
        "discrete": false,
        "lockunlock": false,
        "commandonly": false,
        "queryonly": false,
        "nora": "f1e538c1.0315f8",
        "topic": "ha-switch/switch-blinds-2/state",
        "openvalue": "true",
        "openvalueType": "bool",
        "closevalue": "false",
        "closevalueType": "bool",
        "twofactor": "off",
        "twofactorpin": "",
        "filter": true,
        "x": 1150,
        "y": 860,
        "wires": [
            [
                "8ad4a13f3069f1ac"
            ]
        ]
    },
    {
        "id": "ba592d172f57dd43",
        "type": "noraf-openclose",
        "z": "7d41aab9fd0b6a3e",
        "devicename": "Fixed Shutters",
        "roomhint": "Kitchen",
        "name": "8. kitchen - fixed window",
        "directions": "",
        "openclosetype": "SHUTTER",
        "passthru": false,
        "errorifstateunchaged": false,
        "discrete": false,
        "lockunlock": false,
        "commandonly": false,
        "queryonly": false,
        "nora": "f1e538c1.0315f8",
        "topic": "ha-switch/switch-blinds-8/state",
        "openvalue": "true",
        "openvalueType": "bool",
        "closevalue": "false",
        "closevalueType": "bool",
        "twofactor": "off",
        "twofactorpin": "",
        "filter": true,
        "x": 1170,
        "y": 920,
        "wires": [
            [
                "8ad4a13f3069f1ac"
            ]
        ]
    },
    {
        "id": "6762d86fa674744b",
        "type": "noraf-light",
        "z": "7d41aab9fd0b6a3e",
        "devicename": "Light",
        "lightcolor": false,
        "brightnesscontrol": true,
        "commandonlycolor": false,
        "turnonwhenbrightnesschanges": true,
        "passthru": false,
        "errorifstateunchaged": false,
        "statepayload": true,
        "brightnessoverride": "",
        "roomhint": "Bathroom",
        "name": "5. big bedroom bathroom",
        "colortype": "hsv",
        "nora": "f1e538c1.0315f8",
        "topic": "ha-switch/switch-dimmer-5/state",
        "onvalue": "true",
        "onvalueType": "bool",
        "offvalue": "false",
        "offvalueType": "bool",
        "temperaturemin": "2700",
        "temperaturemax": "5500",
        "twofactor": "off",
        "twofactorpin": "",
        "filter": true,
        "x": 490,
        "y": 560,
        "wires": [
            [
                "80206ddcbd9d94f1"
            ]
        ]
    },
    {
        "id": "340c4ef4bedec8a6",
        "type": "link out",
        "z": "7d41aab9fd0b6a3e",
        "name": "state changed",
        "mode": "link",
        "links": [
            "3fdd728b0585df23",
            "b8a5316364ec5fe8",
            "1b4bb0df8c93cc89",
            "b3a359bc7a838527"
        ],
        "x": 1045,
        "y": 60,
        "wires": []
    },
    {
        "id": "dcb6e3571adc03a9",
        "type": "mqtt in",
        "z": "7d41aab9fd0b6a3e",
        "name": "",
        "topic": "ha-switch/+/state",
        "qos": "0",
        "datatype": "json",
        "broker": "f569d34c.8c7ed",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 610,
        "y": 60,
        "wires": [
            [
                "cb6ee814173dbfcd"
            ]
        ]
    },
    {
        "id": "756f250b09605648",
        "type": "mqtt in",
        "z": "7d41aab9fd0b6a3e",
        "name": "",
        "topic": "ha-switch/+/online",
        "qos": "0",
        "datatype": "json",
        "broker": "f569d34c.8c7ed",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 600,
        "y": 120,
        "wires": [
            [
                "a0e19251ca4aaac4"
            ]
        ]
    },
    {
        "id": "a0e19251ca4aaac4",
        "type": "function",
        "z": "7d41aab9fd0b6a3e",
        "name": "set online",
        "func": "if (typeof msg.payload !== 'boolean') {\n    return;\n}\n\nconst parts = msg.topic.split('/');\nparts[parts.length - 1] = 'state';\n\nreturn {\n    payload: {\n        online: msg.payload,\n    },\n    topic: parts.join('/'),\n};",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 790,
        "y": 120,
        "wires": [
            [
                "cb6ee814173dbfcd"
            ]
        ]
    },
    {
        "id": "b8a5316364ec5fe8",
        "type": "link in",
        "z": "7d41aab9fd0b6a3e",
        "name": "link in 1",
        "links": [
            "340c4ef4bedec8a6"
        ],
        "x": 105,
        "y": 320,
        "wires": [
            [
                "b18a911a13f74c55"
            ]
        ]
    },
    {
        "id": "3fdd728b0585df23",
        "type": "link in",
        "z": "7d41aab9fd0b6a3e",
        "name": "link in 2",
        "links": [
            "340c4ef4bedec8a6"
        ],
        "x": 805,
        "y": 620,
        "wires": [
            [
                "821e92a25e3b217f"
            ]
        ]
    },
    {
        "id": "d1bf6e5c3d819560",
        "type": "link in",
        "z": "7d41aab9fd0b6a3e",
        "name": "update state",
        "links": [
            "6af1216eb7c5c03f",
            "49583d9de218bf42",
            "43ff6ea09782443a",
            "bd1a7b07efa6d260"
        ],
        "x": 1145,
        "y": 100,
        "wires": [
            [
                "f51b18a179ad290d"
            ]
        ]
    },
    {
        "id": "71abf52c70a50205",
        "type": "mqtt out",
        "z": "7d41aab9fd0b6a3e",
        "name": "",
        "topic": "",
        "qos": "0",
        "retain": "true",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "f569d34c.8c7ed",
        "x": 1370,
        "y": 100,
        "wires": []
    },
    {
        "id": "f51b18a179ad290d",
        "type": "function",
        "z": "7d41aab9fd0b6a3e",
        "name": "set state",
        "func": "return {\n    ...msg,\n    topic: `${msg.topic}/set`,\n};\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1240,
        "y": 100,
        "wires": [
            [
                "71abf52c70a50205"
            ]
        ]
    },
    {
        "id": "6af1216eb7c5c03f",
        "type": "link out",
        "z": "7d41aab9fd0b6a3e",
        "name": "link out 1",
        "mode": "link",
        "links": [
            "d1bf6e5c3d819560"
        ],
        "x": 735,
        "y": 320,
        "wires": []
    },
    {
        "id": "49583d9de218bf42",
        "type": "link out",
        "z": "7d41aab9fd0b6a3e",
        "name": "link out 2",
        "mode": "link",
        "links": [
            "d1bf6e5c3d819560"
        ],
        "x": 1445,
        "y": 620,
        "wires": []
    },
    {
        "id": "03e9def7ed68132d",
        "type": "function",
        "z": "7d41aab9fd0b6a3e",
        "name": "map",
        "func": "return {\n    payload: {\n        on: [msg.payload],\n    },\n    topic: msg.topic,\n};",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1350,
        "y": 260,
        "wires": [
            [
                "43ff6ea09782443a"
            ]
        ]
    },
    {
        "id": "26e27a446f7b7444",
        "type": "function",
        "z": "7d41aab9fd0b6a3e",
        "name": "onoff",
        "func": "if (msg.topic.startsWith('ha-switch/switch-onoff-')) {\n    return {\n        payload: {\n            ...msg.payload,\n            ...('on' in msg.payload\n                && Array.isArray(msg.payload.on)\n                && msg.payload.on.length\n                ? { on: msg.payload.on.some(v => v) }\n                : {}),\n        },\n        topic: msg.topic,\n    };\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 890,
        "y": 260,
        "wires": [
            [
                "af0b3ee1164dc74c"
            ]
        ]
    },
    {
        "id": "1b4bb0df8c93cc89",
        "type": "link in",
        "z": "7d41aab9fd0b6a3e",
        "name": "link in 3",
        "links": [
            "340c4ef4bedec8a6"
        ],
        "x": 805,
        "y": 260,
        "wires": [
            [
                "26e27a446f7b7444"
            ]
        ]
    },
    {
        "id": "43ff6ea09782443a",
        "type": "link out",
        "z": "7d41aab9fd0b6a3e",
        "name": "link out 3",
        "mode": "link",
        "links": [
            "d1bf6e5c3d819560"
        ],
        "x": 1445,
        "y": 260,
        "wires": []
    },
    {
        "id": "1eeea8ddfe40852e",
        "type": "noraf-light",
        "z": "7d41aab9fd0b6a3e",
        "devicename": "Light",
        "lightcolor": false,
        "brightnesscontrol": false,
        "commandonlycolor": false,
        "turnonwhenbrightnesschanges": false,
        "passthru": false,
        "errorifstateunchaged": false,
        "statepayload": true,
        "brightnessoverride": "",
        "roomhint": "Washer Room",
        "name": "9. washer room",
        "colortype": "hsv",
        "nora": "f1e538c1.0315f8",
        "topic": "ha-switch/switch-onoff-9/state",
        "onvalue": "true",
        "onvalueType": "bool",
        "offvalue": "false",
        "offvalueType": "bool",
        "temperaturemin": "2700",
        "temperaturemax": "5500",
        "twofactor": "off",
        "twofactorpin": "",
        "filter": true,
        "x": 1140,
        "y": 200,
        "wires": [
            [
                "03e9def7ed68132d"
            ]
        ]
    },
    {
        "id": "144549cc6dc7cbe7",
        "type": "noraf-light",
        "z": "7d41aab9fd0b6a3e",
        "devicename": "Light",
        "lightcolor": false,
        "brightnesscontrol": false,
        "commandonlycolor": false,
        "turnonwhenbrightnesschanges": false,
        "passthru": false,
        "errorifstateunchaged": false,
        "statepayload": true,
        "brightnessoverride": "",
        "roomhint": "Guest Bathroom",
        "name": "3. bathroom - guest",
        "colortype": "hsv",
        "nora": "f1e538c1.0315f8",
        "topic": "ha-switch/switch-onoff-3/state",
        "onvalue": "true",
        "onvalueType": "bool",
        "offvalue": "false",
        "offvalueType": "bool",
        "temperaturemin": "2700",
        "temperaturemax": "5500",
        "twofactor": "off",
        "twofactorpin": "",
        "filter": true,
        "x": 1150,
        "y": 260,
        "wires": [
            [
                "03e9def7ed68132d"
            ]
        ]
    },
    {
        "id": "8714fba0422dd9f9",
        "type": "noraf-light",
        "z": "7d41aab9fd0b6a3e",
        "devicename": "Light",
        "lightcolor": false,
        "brightnesscontrol": false,
        "commandonlycolor": false,
        "turnonwhenbrightnesschanges": false,
        "passthru": false,
        "errorifstateunchaged": false,
        "statepayload": true,
        "brightnessoverride": "",
        "roomhint": "Service Room",
        "name": "1. cam. tehnica",
        "colortype": "hsv",
        "nora": "f1e538c1.0315f8",
        "topic": "ha-switch/switch-onoff-1/state",
        "onvalue": "true",
        "onvalueType": "bool",
        "offvalue": "false",
        "offvalueType": "bool",
        "temperaturemin": "2700",
        "temperaturemax": "5500",
        "twofactor": "off",
        "twofactorpin": "",
        "filter": true,
        "x": 1140,
        "y": 320,
        "wires": [
            [
                "03e9def7ed68132d"
            ]
        ]
    },
    {
        "id": "b2a67d17df0195f8",
        "type": "noraf-light",
        "z": "7d41aab9fd0b6a3e",
        "devicename": "Light",
        "lightcolor": false,
        "brightnesscontrol": true,
        "commandonlycolor": false,
        "turnonwhenbrightnesschanges": true,
        "passthru": false,
        "errorifstateunchaged": false,
        "statepayload": true,
        "brightnessoverride": "",
        "roomhint": "Main Bathroom",
        "name": "9. main bathroom",
        "colortype": "hsv",
        "nora": "f1e538c1.0315f8",
        "topic": "ha-switch/switch-dimmer-9/state",
        "onvalue": "true",
        "onvalueType": "bool",
        "offvalue": "false",
        "offvalueType": "bool",
        "temperaturemin": "2700",
        "temperaturemax": "5500",
        "twofactor": "off",
        "twofactorpin": "",
        "filter": true,
        "x": 470,
        "y": 740,
        "wires": [
            [
                "80206ddcbd9d94f1"
            ]
        ]
    },
    {
        "id": "31ccd8e9f0a2e09e",
        "type": "noraf-light",
        "z": "7d41aab9fd0b6a3e",
        "devicename": "Entrance",
        "lightcolor": false,
        "brightnesscontrol": true,
        "commandonlycolor": false,
        "turnonwhenbrightnesschanges": true,
        "passthru": false,
        "errorifstateunchaged": false,
        "statepayload": true,
        "brightnessoverride": "",
        "roomhint": "Hallway",
        "name": "10. hallway - entrance",
        "colortype": "hsv",
        "nora": "f1e538c1.0315f8",
        "topic": "ha-switch/switch-dimmer-10/state",
        "onvalue": "true",
        "onvalueType": "bool",
        "offvalue": "false",
        "offvalueType": "bool",
        "temperaturemin": "2700",
        "temperaturemax": "5500",
        "twofactor": "off",
        "twofactorpin": "",
        "filter": true,
        "x": 480,
        "y": 260,
        "wires": [
            [
                "80206ddcbd9d94f1"
            ]
        ]
    },
    {
        "id": "c78d7adf71b71c07",
        "type": "noraf-light",
        "z": "7d41aab9fd0b6a3e",
        "devicename": "Entrance",
        "lightcolor": false,
        "brightnesscontrol": false,
        "commandonlycolor": false,
        "turnonwhenbrightnesschanges": false,
        "passthru": false,
        "errorifstateunchaged": false,
        "statepayload": true,
        "brightnessoverride": "",
        "roomhint": "Outside",
        "name": "7. outside - entrance",
        "colortype": "hsv",
        "nora": "f1e538c1.0315f8",
        "topic": "ha-switch/switch-onoff-7/state",
        "onvalue": "true",
        "onvalueType": "bool",
        "offvalue": "false",
        "offvalueType": "bool",
        "temperaturemin": "2700",
        "temperaturemax": "5500",
        "twofactor": "off",
        "twofactorpin": "",
        "filter": true,
        "x": 1160,
        "y": 380,
        "wires": [
            [
                "03e9def7ed68132d"
            ]
        ]
    },
    {
        "id": "6ebdf6901c3c44a1",
        "type": "noraf-switch",
        "z": "7d41aab9fd0b6a3e",
        "devicename": "Water Pump",
        "roomhint": "Service Room",
        "name": "r1. water pump",
        "passthru": false,
        "errorifstateunchaged": false,
        "nora": "f1e538c1.0315f8",
        "topic": "ha-switch/switch-onoff-r1/state",
        "onvalue": "true",
        "onvalueType": "bool",
        "offvalue": "false",
        "offvalueType": "bool",
        "twofactor": "ack",
        "twofactorpin": "",
        "filter": true,
        "asyncCmd": false,
        "outputs": 1,
        "x": 1140,
        "y": 440,
        "wires": [
            [
                "03e9def7ed68132d"
            ]
        ]
    },
    {
        "id": "52cbf133f2f61326",
        "type": "function",
        "z": "7d41aab9fd0b6a3e",
        "name": "Clone On/Off",
        "func": "/**\n * @type Map<string, {topic:string, type:'onoff'|'offonly'}>\n */\nconst CTRL = new Map([\n    ['ha-switch/switch-dimmer-5/state', { topic: 'ha-switch/switch-onoff-4/state', type: 'onoff' }],\n    ['ha-switch/switch-dimmer-9/state', { topic: 'ha-switch/switch-onoff-6/state', type: 'onoff' }],\n    ['ha-switch/switch-onoff-5/state', { topic: 'ha-switch/switch-onoff-8/state', type: 'offonly' }],\n]);\n\nconst topic = msg.topic;\nconst to = CTRL.get(topic);\nif (!to) {\n    return;\n}\n\nlet on = msg.payload.on;\nif (Array.isArray(on) && on.length) {\n    on = on[0];\n}\nif (typeof on != 'boolean') {\n    return;\n}\n\nconst lastOn = context.get(topic);\nif (lastOn !== on) {\n    context.set(topic, on);\n\n    if (to.type === 'offonly' && on) {\n        return;\n    }\n\n    return {\n        topic: to.topic,\n        payload: {\n            on: [on],\n        },\n    };\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 230,
        "y": 840,
        "wires": [
            [
                "bd1a7b07efa6d260"
            ]
        ]
    },
    {
        "id": "b3a359bc7a838527",
        "type": "link in",
        "z": "7d41aab9fd0b6a3e",
        "name": "link in 5",
        "links": [
            "340c4ef4bedec8a6"
        ],
        "x": 115,
        "y": 840,
        "wires": [
            [
                "52cbf133f2f61326"
            ]
        ]
    },
    {
        "id": "bd1a7b07efa6d260",
        "type": "link out",
        "z": "7d41aab9fd0b6a3e",
        "name": "link out 5",
        "mode": "link",
        "links": [
            "d1bf6e5c3d819560"
        ],
        "x": 345,
        "y": 840,
        "wires": []
    },
    {
        "id": "177b7b13cf11baf0",
        "type": "noraf-light",
        "z": "7d41aab9fd0b6a3e",
        "devicename": "Light",
        "lightcolor": false,
        "brightnesscontrol": false,
        "commandonlycolor": false,
        "turnonwhenbrightnesschanges": false,
        "passthru": false,
        "errorifstateunchaged": false,
        "statepayload": true,
        "brightnessoverride": "",
        "roomhint": "Guest Room",
        "name": "2. bedroom - guest",
        "colortype": "hsv",
        "nora": "f1e538c1.0315f8",
        "topic": "ha-switch/switch-onoff-2/state",
        "onvalue": "true",
        "onvalueType": "bool",
        "offvalue": "false",
        "offvalueType": "bool",
        "temperaturemin": "2700",
        "temperaturemax": "5500",
        "twofactor": "off",
        "twofactorpin": "",
        "filter": true,
        "x": 1150,
        "y": 500,
        "wires": [
            [
                "03e9def7ed68132d"
            ]
        ]
    },
    {
        "id": "cfd8480b606b454e",
        "type": "noraf-light",
        "z": "7d41aab9fd0b6a3e",
        "d": true,
        "devicename": "Light",
        "lightcolor": false,
        "brightnesscontrol": false,
        "commandonlycolor": false,
        "turnonwhenbrightnesschanges": false,
        "passthru": false,
        "errorifstateunchaged": false,
        "statepayload": true,
        "brightnessoverride": "",
        "roomhint": "Dressing",
        "name": "5. dressing",
        "colortype": "hsv",
        "nora": "f1e538c1.0315f8",
        "topic": "ha-switch/switch-onoff-5/state",
        "onvalue": "true",
        "onvalueType": "bool",
        "offvalue": "false",
        "offvalueType": "bool",
        "temperaturemin": "2700",
        "temperaturemax": "5500",
        "twofactor": "off",
        "twofactorpin": "",
        "filter": true,
        "x": 550,
        "y": 900,
        "wires": [
            []
        ]
    },
    {
        "id": "72228fcd02ae304f",
        "type": "noraf-light",
        "z": "7d41aab9fd0b6a3e",
        "d": true,
        "devicename": "Light",
        "lightcolor": false,
        "brightnesscontrol": false,
        "commandonlycolor": false,
        "turnonwhenbrightnesschanges": false,
        "passthru": false,
        "errorifstateunchaged": false,
        "statepayload": true,
        "brightnessoverride": "",
        "roomhint": "Dressing Mirror",
        "name": "8. dressing mirror",
        "colortype": "hsv",
        "nora": "f1e538c1.0315f8",
        "topic": "ha-switch/switch-onoff-8/state",
        "onvalue": "true",
        "onvalueType": "bool",
        "offvalue": "false",
        "offvalueType": "bool",
        "temperaturemin": "2700",
        "temperaturemax": "5500",
        "twofactor": "off",
        "twofactorpin": "",
        "filter": true,
        "x": 570,
        "y": 940,
        "wires": [
            []
        ]
    },
    {
        "id": "a3dbdc255ebe8243",
        "type": "noraf-openclose",
        "z": "7d41aab9fd0b6a3e",
        "devicename": "Shutters",
        "roomhint": "Guest Room",
        "name": "1. guest room",
        "directions": "",
        "openclosetype": "SHUTTER",
        "passthru": false,
        "errorifstateunchaged": false,
        "discrete": false,
        "lockunlock": false,
        "commandonly": false,
        "queryonly": false,
        "nora": "f1e538c1.0315f8",
        "topic": "ha-switch/switch-blinds-1/state",
        "openvalue": "true",
        "openvalueType": "bool",
        "closevalue": "false",
        "closevalueType": "bool",
        "twofactor": "off",
        "twofactorpin": "",
        "filter": true,
        "x": 1140,
        "y": 560,
        "wires": [
            [
                "8ad4a13f3069f1ac"
            ]
        ]
    },
    {
        "id": "cb6ee814173dbfcd",
        "type": "function",
        "z": "7d41aab9fd0b6a3e",
        "name": "store state",
        "func": "const value = global.get(msg.topic) || { online: true };\n\nif (Array.isArray(msg.payload.on) && msg.payload.on.length === 1) {\n    msg.payload.on = msg.payload.on[0];\n}\n\nglobal.set(msg.topic, {\n    ...value,\n    ...msg.payload,\n});\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 910,
        "y": 60,
        "wires": [
            [
                "340c4ef4bedec8a6"
            ]
        ]
    },
    {
        "id": "e6892c53b951d955",
        "type": "function",
        "z": "13aa577370e4c4d7",
        "name": "Last Message",
        "func": "const now = new Date();\nconst last = context.get(msg.topic) || {};\nconst span = last ? (now.getTime() - last.lastTick) / 1000 : null;\nconst maxSpan = last && span ? Math.max(last.maxSpan, span) : null;\n\ncontext.set(msg.topic, {\n    lastTick: now.getTime(),\n    last: now.toLocaleString(),\n    maxSpan,\n});\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 400,
        "y": 180,
        "wires": [
            [
                "a2c9d6a36b64dbb9"
            ]
        ]
    },
    {
        "id": "46c6a15226b95a40",
        "type": "mqtt in",
        "z": "13aa577370e4c4d7",
        "name": "",
        "topic": "zigbee2mqtt/temp/+",
        "qos": "2",
        "datatype": "json",
        "broker": "f569d34c.8c7ed",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 130,
        "y": 140,
        "wires": [
            [
                "e6892c53b951d955"
            ]
        ]
    },
    {
        "id": "3f2e0c17ed43535a",
        "type": "mqtt in",
        "z": "13aa577370e4c4d7",
        "name": "",
        "topic": "zigbee2mqtt/pir/+",
        "qos": "2",
        "datatype": "json",
        "broker": "f569d34c.8c7ed",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 120,
        "y": 180,
        "wires": [
            [
                "e6892c53b951d955"
            ]
        ]
    },
    {
        "id": "568b712cbc5d52ec",
        "type": "mqtt in",
        "z": "13aa577370e4c4d7",
        "name": "",
        "topic": "zigbee2mqtt/light/+",
        "qos": "2",
        "datatype": "json",
        "broker": "f569d34c.8c7ed",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 130,
        "y": 220,
        "wires": [
            [
                "e6892c53b951d955"
            ]
        ]
    },
    {
        "id": "1432e0debb3006ca",
        "type": "mqtt in",
        "z": "13aa577370e4c4d7",
        "name": "",
        "topic": "zigbee2mqtt/switch/+",
        "qos": "2",
        "datatype": "json",
        "broker": "f569d34c.8c7ed",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 140,
        "y": 260,
        "wires": [
            [
                "e6892c53b951d955"
            ]
        ]
    },
    {
        "id": "eb8c54867345d225",
        "type": "mqtt in",
        "z": "13aa577370e4c4d7",
        "name": "",
        "topic": "stat/+/+/RESULT",
        "qos": "2",
        "datatype": "json",
        "broker": "f569d34c.8c7ed",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 120,
        "y": 100,
        "wires": [
            [
                "e6892c53b951d955"
            ]
        ]
    },
    {
        "id": "532c2f5d16d7a052",
        "type": "mqtt in",
        "z": "13aa577370e4c4d7",
        "name": "",
        "topic": "zigbee2mqtt/relay/+",
        "qos": "2",
        "datatype": "json",
        "broker": "f569d34c.8c7ed",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 130,
        "y": 300,
        "wires": [
            [
                "e6892c53b951d955"
            ]
        ]
    },
    {
        "id": "42e556342bd34fe3",
        "type": "node-ups",
        "z": "13aa577370e4c4d7",
        "port": "/dev/serial/by-id/usb-Silicon_Labs_CP2102_USB_to_UART_Bridge_Controller_0001-if00-port0",
        "name": "",
        "topic": "",
        "x": 90,
        "y": 400,
        "wires": [
            [
                "3d478a662ee44292"
            ],
            [
                "66f0242e1156827d"
            ]
        ]
    },
    {
        "id": "66f0242e1156827d",
        "type": "function",
        "z": "13aa577370e4c4d7",
        "name": "GRID status",
        "func": "const now = new Date();\nconst status = msg.payload === 'POWER' ? 'ONLINE' : 'OFFLINE';\nnode.status({\n    fill: status === 'ONLINE' ? 'green' : 'red',\n    shape: 'dot',\n    text: status,\n});\n\nflow.set('grid_offline', status === 'OFFLINE');\nflow.set('last_grid_status_change', new Date().getTime());\n\nconst key = `${now.getMonth() + 1}-${now.getDate()}`;\nconst powerLosses = flow.get('power') || {};\nlet perDay = powerLosses[key];\nif (!perDay) {\n    powerLosses[key] = perDay = [];\n}\nif (perDay[perDay.length - 1]?.status === status) {\n    //handle restarts of nodered...\n    return;\n}\nperDay.push({ at: now.toLocaleTimeString(), status });\nflow.set('power', powerLosses);\n\nlet recovered = '';\nif (status === 'OFFLINE') {\n    context.set('offline', now.getTime());\n} else {\n    const offlineAt = context.get('offline');\n    context.set('offline', null);\n    if (typeof offlineAt === 'number') {\n        let span = (now.getTime() - offlineAt) / 1000;\n        let unit = 'sec';\n        if (span >= 60) {\n            span /= 60;\n            unit = 'min';\n\n            if (span >= 60) {\n                span /= 60;\n                unit = 'h';\n\n                if (span >= 24) {\n                    span /= 24;\n                    unit = 'day';\n                }\n            }\n        }\n\n        recovered = ` Recovered after ${span} ${unit}.`;\n    }\n}\n\n\nreturn {\n    payload: {\n        tag: `power`,\n        title: 'Grid Status',\n        body: `${status} at ${now.toLocaleString()}.${recovered}`,\n    },\n};",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 310,
        "y": 480,
        "wires": [
            [
                "684884b00c3e9fad"
            ]
        ]
    },
    {
        "id": "684884b00c3e9fad",
        "type": "noraf-notify",
        "z": "13aa577370e4c4d7",
        "tag": "",
        "title": "??",
        "body": "??",
        "icon": "",
        "name": "Notify",
        "nora": "f1e538c1.0315f8",
        "topic": "",
        "actions": [],
        "closeNotification": false,
        "x": 730,
        "y": 380,
        "wires": [
            []
        ]
    },
    {
        "id": "b7e650722bc17863",
        "type": "function",
        "z": "13aa577370e4c4d7",
        "name": "UPS battery",
        "func": "if (msg.payload.battery.soc < 25) {\n    return {\n        payload: {\n            tag: 'ups-battery',\n            title: 'Warning',\n            body: `UPS battery low (${msg.payload.battery.soc}%)`,\n        },\n    };\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 310,
        "y": 380,
        "wires": [
            [
                "2222fb495b79673f"
            ]
        ]
    },
    {
        "id": "a2c9d6a36b64dbb9",
        "type": "function",
        "z": "13aa577370e4c4d7",
        "name": "Battery low",
        "func": "if (msg.payload?.battery_low === true ||\n    msg.payload?.battery < 20) {\n    const now = new Date().toLocaleString();\n    const location = msg.topic.substring(msg.topic.indexOf('/') + 1);\n    return {\n        topic: location,\n        payload: {\n            tag: location,\n            title: 'Battery low',\n            body: `${location} at ${now}. Battery: ${msg.payload.battery ?? -1}. Low: ${msg.payload.battery_low}`,\n        },\n    };\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 410,
        "y": 240,
        "wires": [
            [
                "6ac061a53b0101c8"
            ]
        ]
    },
    {
        "id": "5b83184da40ca65f",
        "type": "trigger",
        "z": "13aa577370e4c4d7",
        "name": "",
        "op1": "",
        "op2": "true",
        "op1type": "nul",
        "op2type": "bool",
        "duration": "30",
        "extend": true,
        "overrideDelay": false,
        "units": "s",
        "reset": "",
        "bytopic": "all",
        "topic": "topic",
        "outputs": 1,
        "x": 310,
        "y": 340,
        "wires": [
            [
                "d10c6183a957ae08"
            ]
        ]
    },
    {
        "id": "d10c6183a957ae08",
        "type": "function",
        "z": "13aa577370e4c4d7",
        "name": "UPS connection down",
        "func": "const now = new Date();\nreturn {\n    payload: {\n        tag: 'ups-connection',\n        title: 'Warning',\n        body: `UPS connection is down ${now.toLocaleString()}`,\n    }\n};\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 500,
        "y": 340,
        "wires": [
            [
                "684884b00c3e9fad"
            ]
        ]
    },
    {
        "id": "2222fb495b79673f",
        "type": "trigger",
        "z": "13aa577370e4c4d7",
        "name": "",
        "op1": "",
        "op2": "",
        "op1type": "pay",
        "op2type": "nul",
        "duration": "15",
        "extend": false,
        "overrideDelay": false,
        "units": "min",
        "reset": "",
        "bytopic": "all",
        "topic": "topic",
        "outputs": 1,
        "x": 490,
        "y": 380,
        "wires": [
            [
                "684884b00c3e9fad"
            ]
        ]
    },
    {
        "id": "6ac061a53b0101c8",
        "type": "trigger",
        "z": "13aa577370e4c4d7",
        "name": "",
        "op1": "",
        "op2": "",
        "op1type": "pay",
        "op2type": "nul",
        "duration": "24",
        "extend": false,
        "overrideDelay": false,
        "units": "hr",
        "reset": "",
        "bytopic": "topic",
        "topic": "topic",
        "outputs": 1,
        "x": 570,
        "y": 240,
        "wires": [
            [
                "684884b00c3e9fad"
            ]
        ]
    },
    {
        "id": "357104d13b31bb08",
        "type": "function",
        "z": "13aa577370e4c4d7",
        "name": "Status",
        "func": "const { grid: { voltage, frequency }, battery: { soc } } = msg.payload;\n\n\nnode.status({\n    fill: \"blue\",\n    shape: \"ring\",\n    text: `${voltage}V ${Math.round(frequency * 100) / 100}Hz ${soc}%`,\n});\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 290,
        "y": 420,
        "wires": [
            []
        ]
    },
    {
        "id": "c34a5e4a5660de91",
        "type": "mqtt in",
        "z": "13aa577370e4c4d7",
        "name": "",
        "topic": "ha-switch/+/online",
        "qos": "0",
        "datatype": "json",
        "broker": "f569d34c.8c7ed",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 130,
        "y": 560,
        "wires": [
            [
                "184032aab20a73e0"
            ]
        ]
    },
    {
        "id": "184032aab20a73e0",
        "type": "function",
        "z": "13aa577370e4c4d7",
        "d": true,
        "name": "notify when offline",
        "func": "if (typeof msg.payload !== 'boolean' || msg.payload) {\n    return;\n}\n\nconst now = new Date().getTime();\n\nconst lastGridStatusChange = flow.get('last_grid_status_change');\nif (typeof lastGridStatusChange === 'number') {\n    if (now - lastGridStatusChange < 300000) {\n        // grid status changed in the last 5 mins, ignore offline messages\n        return;\n    }\n}\n\nconst lastOfflines = context.get('last5min') || {};\nfor (const key of Object.keys(lastOfflines)) {\n    const delta = (now - lastOfflines[key]) / 1000;\n    if (delta > 60) {\n        delete lastOfflines[key];\n    }\n}\n\nconst name = msg.topic.split('/')[1];\nlastOfflines[name] = now;\ncontext.set('last5min', lastOfflines);\n\nif (flow.get('grid_offline') === false) {\n    const names = Object.keys(lastOfflines).join(',');\n    const nowString = new Date().toLocaleString();\n    node.send({\n        payload: {\n            tag: `devices-offline`,\n            title: 'Device(s) offline',\n            body: `${names} at ${nowString}`,\n        },\n    });\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 330,
        "y": 560,
        "wires": [
            [
                "a24cb7686bd98421"
            ]
        ]
    },
    {
        "id": "3f3c88e152b83b07",
        "type": "mqtt in",
        "z": "13aa577370e4c4d7",
        "name": "",
        "topic": "ha-switch/+/reset-reason",
        "qos": "0",
        "datatype": "utf8",
        "broker": "f569d34c.8c7ed",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 150,
        "y": 620,
        "wires": [
            [
                "344c6d12cc3b6df2"
            ]
        ]
    },
    {
        "id": "344c6d12cc3b6df2",
        "type": "function",
        "z": "13aa577370e4c4d7",
        "name": "notify reason",
        "func": "const RESET_CAUSE = {\n    '0': 'NO_MEAN',\n    '1': 'POWERON',\n    '3': 'SW',\n    '4': 'OWDT',\n    '5': 'DEEPSLEEP',\n    '6': 'SDIO',\n    '7': 'TG0WDT_SYS',\n    '8': 'TG1WDT_SYS',\n    '9': 'RTCWDT_SYS',\n    '10': 'INTRUSION',\n    '11': 'TGWDT_CPU',\n    '12': 'SW_CPU',\n    '13': 'RTCWDT_CPU',\n    '14': 'EXT_CPU',\n    '15': 'RTCWDT_BROWN_OUT',\n    '16': 'RTCWDT_RTC',\n};\n\nconst reason = msg.payload;\nconst name = msg.topic.split('/')[1];\nconst last = context.get('last5min') || {};\nconst now = new Date().getTime();\n\nfor (const key of Object.keys(last)) {\n    const delta = (now - last[key].at) / 1000;\n    if (delta > 60) {\n        delete last[key];\n    }\n}\n\nlast[name] = { at: now, reason: RESET_CAUSE[reason] ?? 'unknown' };\ncontext.set('last5min', last);\n\nconst lastGridChange = flow.get('last_grid_status_change');\nif (lastGridChange && Math.abs(now - lastGridChange) < 30000) {\n    return;\n}\n\nconst names = Object.keys(last).map(k => `${k}-${last[k].reason}`).join(', ');\nconst nowString = new Date().toLocaleString();\nnode.send({\n    payload: {\n        tag: `devices-reset`,\n        title: 'Device(s) reset',\n        body: `${names}`,\n    },\n});\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 350,
        "y": 620,
        "wires": [
            [
                "a24cb7686bd98421"
            ]
        ]
    },
    {
        "id": "a24cb7686bd98421",
        "type": "trigger",
        "z": "13aa577370e4c4d7",
        "name": "",
        "op1": "",
        "op2": "",
        "op1type": "nul",
        "op2type": "payl",
        "duration": "30",
        "extend": true,
        "overrideDelay": false,
        "units": "s",
        "reset": "",
        "bytopic": "topic",
        "topic": "payload.tag",
        "outputs": 1,
        "x": 530,
        "y": 580,
        "wires": [
            [
                "684884b00c3e9fad"
            ]
        ]
    },
    {
        "id": "f08cfee748e21645",
        "type": "function",
        "z": "536b0e9eda614fd2",
        "name": "Map",
        "func": "let name = msg.topic.substring(msg.topic.indexOf('/') + 1);\n\nconst PREFIX = '/RESULT';\nif (name.endsWith(PREFIX)) {\n    name = name.substring(0, name.length - PREFIX.length);\n}\n\nconst previousPayload = global.get(name) ?? {};\nconst payload = {\n    ...previousPayload,\n    ...v('temperature'),\n    ...v('humidity'),\n    ...v('state', 'on', p => p === 'ON'),\n    ...v('POWER', 'on', p => p === 'ON'),\n    ...v('Dimmer', 'brightness'),\n    ...v('occupancy'),\n    online: msg.payload?.online ?? true,\n};\nglobal.set(name, payload);\n\nreturn {\n    payload,\n    topic: msg.topic,\n};\n\n/**\n* @param {string} input\n* @param {string} output\n* @param {(a:any)=>any} transform\n* @returns {Record<string, *>}\n*/\nfunction v(input, output = input, transform = x => x) {\n    if (input in msg.payload) {\n        return {\n            [output]: transform(msg.payload[input])\n        };\n    }\n    return {};\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 190,
        "y": 240,
        "wires": [
            [
                "38687e0ac546600f"
            ]
        ]
    },
    {
        "id": "38687e0ac546600f",
        "type": "noraf-switch",
        "z": "536b0e9eda614fd2",
        "devicename": "Warm Water Pump",
        "roomhint": "Service Room",
        "name": "",
        "passthru": false,
        "errorifstateunchaged": false,
        "nora": "f1e538c1.0315f8",
        "topic": "zigbee2mqtt/relay/water-pump",
        "onvalue": "true",
        "onvalueType": "bool",
        "offvalue": "false",
        "offvalueType": "bool",
        "twofactor": "ack",
        "twofactorpin": "",
        "filter": true,
        "asyncCmd": false,
        "outputs": 1,
        "x": 370,
        "y": 240,
        "wires": [
            [
                "7d559a43a7ec6440"
            ]
        ]
    },
    {
        "id": "7d559a43a7ec6440",
        "type": "function",
        "z": "536b0e9eda614fd2",
        "name": "Map",
        "func": "return {\n    payload: {\n        state: msg.payload ? 'ON' : 'OFF',\n    },\n    topic: msg.topic + '/set',\n};",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 570,
        "y": 240,
        "wires": [
            [
                "b02b6ceb7687e947"
            ]
        ]
    },
    {
        "id": "b02b6ceb7687e947",
        "type": "mqtt out",
        "z": "536b0e9eda614fd2",
        "name": "",
        "topic": "",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "f569d34c.8c7ed",
        "x": 790,
        "y": 240,
        "wires": []
    },
    {
        "id": "857f019fa5ad8be5",
        "type": "switch",
        "z": "536b0e9eda614fd2",
        "name": "",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "regex",
                "v": ".+\\/relay\\/.+",
                "vt": "str",
                "case": false
            },
            {
                "t": "regex",
                "v": ".+\\/temp\\/.+",
                "vt": "str",
                "case": false
            },
            {
                "t": "regex",
                "v": ".+\\/pir\\/.+",
                "vt": "str",
                "case": false
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 570,
        "y": 120,
        "wires": [
            [
                "9cf17a33d6369750"
            ],
            [
                "591e4bb345a80b08"
            ],
            [
                "2e643a135c0bc68a"
            ]
        ]
    },
    {
        "id": "9cf17a33d6369750",
        "type": "trigger",
        "z": "536b0e9eda614fd2",
        "name": "",
        "op1": "",
        "op2": "{\"online\": false}",
        "op1type": "nul",
        "op2type": "json",
        "duration": "20",
        "extend": true,
        "overrideDelay": false,
        "units": "min",
        "reset": "",
        "bytopic": "topic",
        "topic": "topic",
        "outputs": 1,
        "x": 730,
        "y": 60,
        "wires": [
            [
                "18ee405180e7ef0d"
            ]
        ]
    },
    {
        "id": "591e4bb345a80b08",
        "type": "trigger",
        "z": "536b0e9eda614fd2",
        "name": "",
        "op1": "",
        "op2": "{\"online\": false}",
        "op1type": "nul",
        "op2type": "json",
        "duration": "2.2",
        "extend": true,
        "overrideDelay": false,
        "units": "hr",
        "reset": "",
        "bytopic": "topic",
        "topic": "topic",
        "outputs": 1,
        "x": 730,
        "y": 120,
        "wires": [
            [
                "18ee405180e7ef0d"
            ]
        ]
    },
    {
        "id": "e1a0476c7e29f306",
        "type": "cronplus",
        "z": "536b0e9eda614fd2",
        "name": "water pump",
        "outputField": "payload",
        "timeZone": "",
        "persistDynamic": false,
        "commandResponseMsgOutput": "output1",
        "outputs": 1,
        "options": [
            {
                "name": "turn on",
                "topic": "zigbee2mqtt/relay/water-pump/set",
                "payloadType": "str",
                "payload": "ON",
                "expressionType": "cron",
                "expression": "0 0 7 ? * * *",
                "location": "",
                "offset": "0",
                "solarType": "all",
                "solarEvents": "sunrise,sunset"
            },
            {
                "name": "turn off",
                "topic": "zigbee2mqtt/relay/water-pump/set",
                "payloadType": "str",
                "payload": "OFF",
                "expressionType": "cron",
                "expression": "0 0 22 ? * * *",
                "location": "",
                "offset": "0",
                "solarType": "all",
                "solarEvents": "sunrise,sunset"
            }
        ],
        "x": 130,
        "y": 500,
        "wires": [
            [
                "b6cc3dcb19c105e1"
            ]
        ]
    },
    {
        "id": "b6cc3dcb19c105e1",
        "type": "mqtt out",
        "z": "536b0e9eda614fd2",
        "name": "",
        "topic": "",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "f569d34c.8c7ed",
        "x": 350,
        "y": 500,
        "wires": []
    },
    {
        "id": "5174cbdc84c9deb9",
        "type": "mqtt in",
        "z": "536b0e9eda614fd2",
        "name": "",
        "topic": "zigbee2mqtt/pir/+",
        "qos": "2",
        "datatype": "json",
        "broker": "f569d34c.8c7ed",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 140,
        "y": 80,
        "wires": [
            [
                "59a6f1a86fee64bb"
            ]
        ]
    },
    {
        "id": "c77921bad91a3fd4",
        "type": "mqtt in",
        "z": "536b0e9eda614fd2",
        "name": "",
        "topic": "zigbee2mqtt/temp/+",
        "qos": "2",
        "datatype": "json",
        "broker": "f569d34c.8c7ed",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 150,
        "y": 40,
        "wires": [
            [
                "59a6f1a86fee64bb"
            ]
        ]
    },
    {
        "id": "9e54c33578b35bbc",
        "type": "mqtt in",
        "z": "536b0e9eda614fd2",
        "name": "",
        "topic": "zigbee2mqtt/relay/+",
        "qos": "2",
        "datatype": "json",
        "broker": "f569d34c.8c7ed",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 150,
        "y": 120,
        "wires": [
            [
                "59a6f1a86fee64bb"
            ]
        ]
    },
    {
        "id": "32d650ad5f529b41",
        "type": "mqtt in",
        "z": "536b0e9eda614fd2",
        "name": "",
        "topic": "zigbee2mqtt/light/+",
        "qos": "2",
        "datatype": "json",
        "broker": "f569d34c.8c7ed",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 150,
        "y": 160,
        "wires": [
            [
                "59a6f1a86fee64bb"
            ]
        ]
    },
    {
        "id": "8d660f4ac3640160",
        "type": "link in",
        "z": "536b0e9eda614fd2",
        "name": "link in 6",
        "links": [
            "59a6f1a86fee64bb"
        ],
        "x": 455,
        "y": 120,
        "wires": [
            [
                "857f019fa5ad8be5"
            ]
        ]
    },
    {
        "id": "59a6f1a86fee64bb",
        "type": "link out",
        "z": "536b0e9eda614fd2",
        "name": "z2mqtt",
        "mode": "link",
        "links": [
            "8d660f4ac3640160",
            "556407976cf82dd1"
        ],
        "x": 315,
        "y": 40,
        "wires": []
    },
    {
        "id": "556407976cf82dd1",
        "type": "link in",
        "z": "536b0e9eda614fd2",
        "name": "link in 7",
        "links": [
            "59a6f1a86fee64bb",
            "18ee405180e7ef0d"
        ],
        "x": 75,
        "y": 240,
        "wires": [
            [
                "f08cfee748e21645"
            ]
        ]
    },
    {
        "id": "18ee405180e7ef0d",
        "type": "link out",
        "z": "536b0e9eda614fd2",
        "name": "z2mqtt",
        "mode": "link",
        "links": [
            "556407976cf82dd1"
        ],
        "x": 855,
        "y": 100,
        "wires": []
    },
    {
        "id": "2e643a135c0bc68a",
        "type": "trigger",
        "z": "536b0e9eda614fd2",
        "name": "",
        "op1": "",
        "op2": "{\"online\": false}",
        "op1type": "nul",
        "op2type": "json",
        "duration": "1.5",
        "extend": true,
        "overrideDelay": false,
        "units": "hr",
        "reset": "",
        "bytopic": "topic",
        "topic": "topic",
        "outputs": 1,
        "x": 730,
        "y": 180,
        "wires": [
            [
                "18ee405180e7ef0d"
            ]
        ]
    },
    {
        "id": "dfca40dd7aa881e6",
        "type": "mqtt in",
        "z": "05e865126427c1f9",
        "name": "",
        "topic": "zigbee2mqtt/pir/+",
        "qos": "2",
        "datatype": "json",
        "broker": "f569d34c.8c7ed",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 140,
        "y": 80,
        "wires": [
            [
                "a0bf8cda615f1687",
                "309ce3ec93316bc9"
            ]
        ]
    },
    {
        "id": "a0bf8cda615f1687",
        "type": "function",
        "z": "05e865126427c1f9",
        "d": true,
        "name": "When motion",
        "func": "/**\n * @type Array<{src:Array<string>, target:string}>\n */\nconst targetByPir = [\n    {\n        src: ['hallway-1', 'hallway-2'],\n        target: 'switch-dimmer-3',\n    }, {\n        src: ['hallway-3'],\n        target: 'switch-dimmer-10',\n    }\n]\n\nconst parts = msg.topic.split('/');\nconst name = parts[parts.length - 1];\nconst found = targetByPir.find(t => t.src.includes(name));\n\nif (msg.payload.occupancy && found) {\n    return {\n        payload: {\n            'brightness': 15,\n            'for': 300\n        },\n        topic: `ha-switch/${found.target}/state/set`,\n    };\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "var  timer;\n",
        "finalize": "",
        "libs": [],
        "x": 370,
        "y": 80,
        "wires": [
            [
                "05ebecdb8b80ec34"
            ]
        ],
        "outputLabels": [
            "battery low"
        ]
    },
    {
        "id": "05ebecdb8b80ec34",
        "type": "mqtt out",
        "z": "05e865126427c1f9",
        "name": "",
        "topic": "",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "f569d34c.8c7ed",
        "x": 830,
        "y": 80,
        "wires": []
    },
    {
        "id": "a42db8829c31d140",
        "type": "inject",
        "z": "05e865126427c1f9",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "ha-switch/switch-dimmer-8/state/set",
        "payload": "{\"brightness\":20, \"for\": 3}",
        "payloadType": "json",
        "x": 650,
        "y": 200,
        "wires": [
            [
                "05ebecdb8b80ec34"
            ]
        ]
    },
    {
        "id": "309ce3ec93316bc9",
        "type": "function",
        "z": "05e865126427c1f9",
        "d": true,
        "name": "When motion",
        "func": "/**\n * @type Array<{src:Array<string>, target:string}>\n */\nconst targetByPir = [\n    {\n        src: ['hallway-1', 'hallway-2'],\n        target: 'switch-dimmer-3',\n    }, {\n        src: ['hallway-3'],\n        target: 'switch-dimmer-10',\n    }\n]\n\nconst parts = msg.topic.split('/');\nconst name = parts[parts.length - 1];\nconst found = targetByPir.find(t => t.src.includes(name));\n\nif (msg.payload.occupancy && found) {\n    return {\n        payload: { on: true },\n        topic: `ha-switch/${found.target}/state/set`,\n    };\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "var  timer;\n",
        "finalize": "",
        "libs": [],
        "x": 370,
        "y": 120,
        "wires": [
            [
                "94000ee52d0a0138"
            ]
        ],
        "outputLabels": [
            "battery low"
        ]
    },
    {
        "id": "94000ee52d0a0138",
        "type": "trigger",
        "z": "05e865126427c1f9",
        "name": "",
        "op1": "",
        "op2": "{\"on\":false}",
        "op1type": "pay",
        "op2type": "json",
        "duration": "5",
        "extend": false,
        "overrideDelay": false,
        "units": "min",
        "reset": "",
        "bytopic": "topic",
        "topic": "topic",
        "outputs": 1,
        "x": 550,
        "y": 120,
        "wires": [
            [
                "05ebecdb8b80ec34"
            ]
        ]
    },
    {
        "id": "bbbdecb1cda7db5e",
        "type": "noraf-doorbell",
        "z": "05e865126427c1f9",
        "devicename": "Doorbell",
        "roomhint": "",
        "name": "",
        "nora": "f1e538c1.0315f8",
        "topic": "",
        "filter": false,
        "x": 600,
        "y": 400,
        "wires": []
    },
    {
        "id": "7dc0804a1cdeba54",
        "type": "inject",
        "z": "05e865126427c1f9",
        "name": "\"Alice\" is at the doorbell",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{\"named\":[\"Alice\"]}",
        "payloadType": "json",
        "x": 280,
        "y": 360,
        "wires": [
            [
                "bbbdecb1cda7db5e"
            ]
        ]
    },
    {
        "id": "1b08bca9fd2551e9",
        "type": "inject",
        "z": "05e865126427c1f9",
        "name": "someone's at the doorbell (unclassified)",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{\"unclassified\":1}",
        "payloadType": "json",
        "x": 330,
        "y": 440,
        "wires": [
            [
                "bbbdecb1cda7db5e"
            ]
        ]
    },
    {
        "id": "71629549d9fd9dc9",
        "type": "inject",
        "z": "05e865126427c1f9",
        "name": "someone you know is at the doorbell",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{\"familiar\":1}",
        "payloadType": "json",
        "x": 320,
        "y": 400,
        "wires": [
            [
                "bbbdecb1cda7db5e"
            ]
        ]
    },
    {
        "id": "aeeedb84a9e88d39",
        "type": "inject",
        "z": "05e865126427c1f9",
        "name": "someone's at the doorbell (unfamiliar)",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{\"unfamiliar\":1}",
        "payloadType": "json",
        "x": 330,
        "y": 480,
        "wires": [
            [
                "bbbdecb1cda7db5e"
            ]
        ]
    },
    {
        "id": "244c26807bc68f0e",
        "type": "sunrise",
        "z": "67e1c6f6bd2fab57",
        "name": "",
        "lat": "45.977066",
        "lon": "21.316671",
        "start": "dawn",
        "end": "sunset",
        "soff": "0",
        "eoff": "0",
        "x": 250,
        "y": 120,
        "wires": [
            [
                "4c7198dcb8cd0684"
            ],
            []
        ]
    },
    {
        "id": "4c7198dcb8cd0684",
        "type": "function",
        "z": "67e1c6f6bd2fab57",
        "name": "outside light on/off",
        "func": "if (!msg.payload) {\n    context.set('light_on', true);\n    turn(true);\n} else if (context.get('light_on')) {\n    context.set('light_on', false);\n    turn(false);\n}\n\n/**\n * @param {boolean} on\n */\nfunction turn(on) {\n    node.send([[\n        {\n            payload: { on },\n            topic: 'ha-switch/switch-dimmer-11/state/set',\n        },\n        {\n            payload: { on: [on] },\n            topic: 'ha-switch/switch-onoff-7/state/set',\n        },\n        {\n            topic: 'zigbee2mqtt-garage/light/outside/set',\n            payload: { state: on ? 'ON' : 'OFF' },\n        },\n        ...getDeckMessages(on),\n    ]]);\n}\n\nfunction getDeckMessages(on) {\n    const deckBase = 'cmnd/tasmota_0F10CB/';\n    const deckDimmer = `${deckBase}/Dimmer`;\n    const deckPower = `${deckBase}/Power`;\n    return on\n        ? [{\n            topic: deckPower,\n            payload: 'ON',\n        }, {\n            topic: deckDimmer,\n            payload: 15,\n        }]\n        : [{\n            topic: deckPower,\n            payload: 'OFF',\n        }];\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 450,
        "y": 120,
        "wires": [
            [
                "bdccd9d28e3a0e9a"
            ]
        ]
    },
    {
        "id": "bdccd9d28e3a0e9a",
        "type": "mqtt out",
        "z": "67e1c6f6bd2fab57",
        "name": "",
        "topic": "",
        "qos": "0",
        "retain": "false",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "f569d34c.8c7ed",
        "x": 670,
        "y": 120,
        "wires": []
    },
    {
        "id": "0d243166fa4cb451",
        "type": "function",
        "z": "67e1c6f6bd2fab57",
        "name": "open/close blinds",
        "func": "\n/** @type Array<{id: number, open?:number, close?: number, openLater?: number}> */\nconst BLINDS = [\n    { id: 1, open: 15, openLater: 100, close: 0 }, // guest\n    { id: 2, open: 100, close: 0 }, // kitchen-window\n    { id: 8, open: 15, close: 0 }, // kitchen-fixed\n    { id: 3, open: 15, openLater: 100, close: 0 }, // big bedroom\n    { id: 4, open: 100 }, // living-door\n    { id: 6, open: 15, openLater: 100, close: 0 }, // living-window\n    { id: 5, open: 100, close: 0 }, // office\n];\n\nconst KEY = 'blindsLastCommand';\n\n/** @type {'open'|'close'|'openLater'} */\n\nif (!msg.payload) {\n    blinds('close');\n} else {\n    const now = new Date();\n    const minTimeToOpenBlinds = new Date();\n    minTimeToOpenBlinds.setHours(7, 30, 0);\n\n    const openLaterTime = new Date();\n    openLaterTime.setHours(8, 0, 0);\n\n    if (now >= minTimeToOpenBlinds && now < openLaterTime) {\n        blinds('open');\n    } else if (now >= openLaterTime) {\n        blinds('openLater');\n    }\n}\n\n/** @param {'open'|'close'|'openLater'} type */\nfunction blinds(type) {\n    const last = context.get(KEY);\n    if (type === last) {\n        return;\n    }\n    context.set(KEY, type);\n\n    if (type.startsWith('open') &&\n        !flow.get('autoOpenBlinds')) {\n        return;\n    }\n\n    const msgs = BLINDS\n        .map(b => {\n            const stateTopic = `ha-switch/switch-blinds-${b.id}/state`;\n            const currentState = global.get(stateTopic);\n\n            const openPercent = b[type];\n            if (typeof openPercent !== 'number') {\n                return;\n            }\n\n            if (currentState) {\n                switch (type) {\n                    case 'open':\n                    case 'openLater':\n                        if (openPercent <= currentState.openPercent) {\n                            return;\n                        }\n                        break;\n                    case 'close':\n                        if (openPercent >= currentState.openPercent) {\n                            //blinds are already more closed\n                            return;\n                        }\n                        break;\n                }\n            }\n\n            return {\n                payload: { openPercent },\n                topic: `${stateTopic}/set`,\n                retain: true,\n            };\n        })\n        .filter(m => !!m);\n    node.send([msgs]);\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 450,
        "y": 180,
        "wires": [
            [
                "11e1c771398804b4"
            ]
        ]
    },
    {
        "id": "11e1c771398804b4",
        "type": "mqtt out",
        "z": "67e1c6f6bd2fab57",
        "name": "",
        "topic": "",
        "qos": "0",
        "retain": "true",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "f569d34c.8c7ed",
        "x": 670,
        "y": 180,
        "wires": []
    },
    {
        "id": "4929a74e2d6431e1",
        "type": "sunrise",
        "z": "67e1c6f6bd2fab57",
        "name": "",
        "lat": "45.977066",
        "lon": "21.316671",
        "start": "sunrise",
        "end": "sunset",
        "soff": "-15",
        "eoff": "0",
        "x": 250,
        "y": 180,
        "wires": [
            [
                "0d243166fa4cb451"
            ],
            []
        ]
    },
    {
        "id": "d2abff84dd6c4311",
        "type": "noraf-switch",
        "z": "67e1c6f6bd2fab57",
        "devicename": "Auto Open Blinds",
        "roomhint": "Service Room",
        "name": "",
        "passthru": false,
        "errorifstateunchaged": false,
        "nora": "f1e538c1.0315f8",
        "topic": "",
        "onvalue": "true",
        "onvalueType": "bool",
        "offvalue": "false",
        "offvalueType": "bool",
        "twofactor": "ack",
        "twofactorpin": "",
        "filter": false,
        "asyncCmd": false,
        "outputs": 1,
        "x": 450,
        "y": 260,
        "wires": [
            [
                "1d90fcaf445ae7bc"
            ]
        ]
    },
    {
        "id": "1d90fcaf445ae7bc",
        "type": "change",
        "z": "67e1c6f6bd2fab57",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "autoOpenBlinds",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 690,
        "y": 260,
        "wires": [
            []
        ]
    },
    {
        "id": "c0db6845e0edacfa",
        "type": "mqtt in",
        "z": "86c7bfe22f048e9c",
        "name": "",
        "topic": "stat/+/RESULT",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "f569d34c.8c7ed",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 120,
        "y": 80,
        "wires": [
            [
                "0a7858e8806c0752",
                "527b1b616ecc0448"
            ]
        ]
    },
    {
        "id": "0a7858e8806c0752",
        "type": "function",
        "z": "86c7bfe22f048e9c",
        "name": "map",
        "func": "const start = msg.topic.indexOf('/') + 1;\nconst deviceName = msg.topic.substring(start, msg.topic.lastIndexOf('/'));\n\nlet state = flow.get(deviceName) ?? {};\nstate = {\n    ...state,\n    ...('POWER' in msg.payload ? { on: msg.payload.POWER == 'ON' } : {}),\n    ...('Dimmer' in msg.payload ? { brightness: msg.payload.Dimmer } : {}),\n    online: 'online' in msg.payload ? msg.payload.online : true,\n};\nflow.set(deviceName, state);\n\nreturn {\n    payload: state,\n    topic: deviceName,\n};",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 330,
        "y": 80,
        "wires": [
            [
                "31a7614427673b14"
            ]
        ]
    },
    {
        "id": "07e1d3f3b09b4c2f",
        "type": "mqtt out",
        "z": "86c7bfe22f048e9c",
        "name": "",
        "topic": "",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "f569d34c.8c7ed",
        "x": 430,
        "y": 240,
        "wires": []
    },
    {
        "id": "724ffcb347b98a4b",
        "type": "function",
        "z": "86c7bfe22f048e9c",
        "name": "map",
        "func": "const deviceName = msg.topic;\nconst state = flow.get(deviceName);\n\nconst messages = [{\n    payload: msg.payload.on ? 'ON' : 'OFF',\n    topic: `cmnd/${deviceName}/Power`,\n}];\n\nif (msg.payload.brightness !== state?.brightness) {\n    messages.push({\n        payload: msg.payload.brightness,\n        topic: `cmnd/${deviceName}/Dimmer`,\n    });\n}\n\nreturn [messages];",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 650,
        "y": 80,
        "wires": [
            [
                "0c205481e356f2f9"
            ]
        ]
    },
    {
        "id": "cd5adb8fd6a89364",
        "type": "inject",
        "z": "86c7bfe22f048e9c",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "60",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "cmnd/tasmota_0F10CB/Dimmer",
        "payload": "",
        "payloadType": "str",
        "x": 200,
        "y": 220,
        "wires": [
            [
                "07e1d3f3b09b4c2f"
            ]
        ]
    },
    {
        "id": "72d29178a2ee85d1",
        "type": "inject",
        "z": "86c7bfe22f048e9c",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "60",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "cmnd/tasmota_0F10CB/Power",
        "payload": "",
        "payloadType": "str",
        "x": 190,
        "y": 260,
        "wires": [
            [
                "07e1d3f3b09b4c2f"
            ]
        ]
    },
    {
        "id": "527b1b616ecc0448",
        "type": "trigger",
        "z": "86c7bfe22f048e9c",
        "name": "",
        "op1": "",
        "op2": "{\"online\": false}",
        "op1type": "nul",
        "op2type": "json",
        "duration": "2",
        "extend": true,
        "overrideDelay": false,
        "units": "min",
        "reset": "",
        "bytopic": "all",
        "topic": "topic",
        "outputs": 1,
        "x": 190,
        "y": 140,
        "wires": [
            [
                "0a7858e8806c0752"
            ]
        ]
    },
    {
        "id": "31a7614427673b14",
        "type": "noraf-light",
        "z": "86c7bfe22f048e9c",
        "devicename": "Deck Light",
        "lightcolor": false,
        "brightnesscontrol": true,
        "commandonlycolor": false,
        "turnonwhenbrightnesschanges": false,
        "passthru": false,
        "errorifstateunchaged": false,
        "statepayload": true,
        "brightnessoverride": "",
        "roomhint": "Outside",
        "name": "",
        "colortype": "hsv",
        "nora": "f1e538c1.0315f8",
        "topic": "tasmota_0F10CB",
        "onvalue": "true",
        "onvalueType": "bool",
        "offvalue": "false",
        "offvalueType": "bool",
        "temperaturemin": "2700",
        "temperaturemax": "5500",
        "twofactor": "off",
        "twofactorpin": "",
        "filter": true,
        "x": 490,
        "y": 80,
        "wires": [
            [
                "724ffcb347b98a4b"
            ]
        ]
    },
    {
        "id": "0c205481e356f2f9",
        "type": "mqtt out",
        "z": "86c7bfe22f048e9c",
        "name": "",
        "topic": "",
        "qos": "",
        "retain": "true",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "f569d34c.8c7ed",
        "x": 790,
        "y": 80,
        "wires": []
    },
    {
        "id": "0cd4f1385c4acbae",
        "type": "inject",
        "z": "4289ddd18011b400",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "cmnd/outlet/t3/pulsetime",
        "payload": "116",
        "payloadType": "str",
        "x": 180,
        "y": 100,
        "wires": [
            [
                "b7e4826693fc3fbc"
            ]
        ]
    },
    {
        "id": "b7e4826693fc3fbc",
        "type": "mqtt out",
        "z": "4289ddd18011b400",
        "name": "",
        "topic": "",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "f569d34c.8c7ed",
        "x": 690,
        "y": 100,
        "wires": []
    },
    {
        "id": "ffdb7ab8e24caa3a",
        "type": "inject",
        "z": "4289ddd18011b400",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "cmnd/outlet/t3/pulsetime",
        "payload": "off",
        "payloadType": "str",
        "x": 180,
        "y": 140,
        "wires": [
            [
                "b7e4826693fc3fbc"
            ]
        ]
    },
    {
        "id": "c53989ecfa9c42d2",
        "type": "mqtt in",
        "z": "4289ddd18011b400",
        "name": "",
        "topic": "stat/outlet/t3/RESULT",
        "qos": "2",
        "datatype": "json",
        "broker": "f569d34c.8c7ed",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 140,
        "y": 200,
        "wires": [
            [
                "a32c1a618f7c8359"
            ]
        ]
    },
    {
        "id": "a32c1a618f7c8359",
        "type": "function",
        "z": "4289ddd18011b400",
        "name": "when turned on, turn off after a few seconds",
        "func": "const prev = context.get('prev');\nconst powerOn = msg.payload.POWER === 'ON';\ncontext.set('prev', powerOn);\n\nif (powerOn && powerOn !== prev) {\n    let topic = msg.topic.split('/');\n    topic = topic.slice(1, topic.length - 1);\n    setTimeout(() => {\n        node.send({\n            payload: 'off',\n            topic: ['cmnd', ...topic, 'power'].join('/'),\n        });\n    }, 17000);\n}\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 450,
        "y": 200,
        "wires": [
            [
                "3910ecc79e784aa4"
            ]
        ]
    },
    {
        "id": "3910ecc79e784aa4",
        "type": "mqtt out",
        "z": "4289ddd18011b400",
        "name": "",
        "topic": "",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "f569d34c.8c7ed",
        "x": 710,
        "y": 200,
        "wires": []
    },
    {
        "id": "5cc7e798047cd148",
        "type": "inject",
        "z": "4289ddd18011b400",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "31 07 * * *",
        "once": false,
        "onceDelay": 0.1,
        "topic": "cmnd/outlet/t3/power",
        "payload": "on",
        "payloadType": "str",
        "x": 180,
        "y": 60,
        "wires": [
            [
                "8750afb90a9573ae"
            ]
        ]
    },
    {
        "id": "8750afb90a9573ae",
        "type": "function",
        "z": "4289ddd18011b400",
        "name": "if auto feed dog is turned on",
        "func": "if (flow.get('auto-feed-dog')) {\n    return msg;\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 460,
        "y": 60,
        "wires": [
            [
                "b7e4826693fc3fbc"
            ]
        ]
    },
    {
        "id": "7826b59e484d0344",
        "type": "noraf-outlet",
        "z": "4289ddd18011b400",
        "devicename": "Auto Feed Dog",
        "roomhint": "Outside",
        "name": "",
        "passthru": false,
        "errorifstateunchaged": true,
        "nora": "f1e538c1.0315f8",
        "topic": "",
        "onvalue": "true",
        "onvalueType": "bool",
        "offvalue": "false",
        "offvalueType": "bool",
        "twofactor": "ack",
        "twofactorpin": "",
        "filter": false,
        "asyncCmd": false,
        "outputs": 1,
        "x": 420,
        "y": 280,
        "wires": [
            [
                "8b09f3d5fe4676da"
            ]
        ]
    },
    {
        "id": "8b09f3d5fe4676da",
        "type": "change",
        "z": "4289ddd18011b400",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "auto-feed-dog",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 630,
        "y": 280,
        "wires": [
            []
        ]
    }
]